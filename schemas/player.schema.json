{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/wpinrui/table-tennis/schemas/player.schema.json",
  "title": "Player",
  "description": "A table tennis player with skill attributes, equipment, shot repertoire, serve tendencies, and playstyle preferences. Each player is a separate JSON file in the /players/ folder. Files can be hand-authored or AI-generated.",
  "type": "object",
  "required": ["name", "handedness", "attributes", "equipment", "preferences", "shots", "serveTendencies"],
  "additionalProperties": false,
  "properties": {
    "name": {
      "type": "string",
      "description": "Player's display name. Must be unique across all player files.",
      "minLength": 1
    },
    "handedness": {
      "type": "string",
      "enum": ["left", "right"],
      "description": "Playing hand. Affects serve angles, forehand/backhand court coverage, and cross-court dynamics."
    },
    "elo": {
      "type": "integer",
      "minimum": 0,
      "description": "Starting ELO rating. Optional — players without ELO are seeded last (randomly) in tournaments. Once the ELO ledger exists, the ledger value takes precedence over this field."
    },
    "attributes": {
      "type": "object",
      "description": "Global attributes that affect all shots and overall play. Scale: 0 (no ability) to 100 (theoretical human peak).",
      "required": ["footwork", "reaction", "spinRead", "deception", "stamina", "mental", "service", "adaptability"],
      "additionalProperties": false,
      "properties": {
        "footwork": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "Recovery speed between shots and ability to reach wide balls. Determines how far toward the recovery position the player moves before the next ball arrives. High footwork = rarely caught out of position."
        },
        "reaction": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "Response time to fast shots. Affects time pressure degradation — a player with high reaction handles fast incoming balls with less quality loss."
        },
        "spinRead": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "Accuracy of reading incoming spin (direction and magnitude). Defensive skill. Low = novice-level misreads (might mistake backspin for topspin). High = pro-level reads (correctly identifies spin type and weight). The receiver's shot selection and execution are based on perceived spin, not actual spin."
        },
        "deception": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "Ability to disguise spin (same arm motion for different spins). Offensive skill. High = opponents can't tell what spin was applied. Interacts with spin range: wide range + high deception is devastating, wide range + low deception is readable, narrow range + high deception gains little."
        },
        "stamina": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "Resistance to fatigue over long matches. As stamina depletes, all shot attributes (power, spin, accuracy, consistency) degrade subtly. High stamina = maintains peak performance deeper into matches."
        },
        "mental": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "Performance under pressure. Affects play quality in high-stakes situations: deuce, match point, comebacks, decisive games. Low mental = chokes under pressure. High mental = thrives in clutch moments."
        },
        "service": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "Serve execution skill. Determines how closely the actual serve matches the player's intended serve properties (speed, spin, placement). Low = large error between intent and result. High = precise execution. Also inherently makes serves harder to read — a skilled server can place the ball tighter to the net/edges and generate more extreme spin."
        },
        "adaptability": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "How quickly the player adjusts tactics mid-match based on what's working or failing. High = reads the game well and shifts tendencies quickly (e.g., stops serving long after opponent keeps attacking them). Low = stubbornly sticks to their game plan even when it's failing. Affects both serve tendencies and shot preferences during a match."
        }
      }
    },
    "equipment": {
      "type": "object",
      "description": "Paddle equipment configuration. Rubber type fundamentally changes viable shots and ball behavior.",
      "required": ["blade", "forehandRubber", "backhandRubber"],
      "additionalProperties": false,
      "properties": {
        "blade": {
          "type": "object",
          "description": "The paddle blade (wooden core).",
          "required": ["speed"],
          "additionalProperties": false,
          "properties": {
            "speed": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100,
              "description": "Blade speed rating. Affects how much pace the player can generate. Carbon blades rate higher; all-wood blades rate lower but offer more control."
            }
          }
        },
        "forehandRubber": {
          "$ref": "#/$defs/rubber",
          "description": "Rubber on the forehand side of the paddle."
        },
        "backhandRubber": {
          "$ref": "#/$defs/rubber",
          "description": "Rubber on the backhand side of the paddle."
        }
      }
    },
    "preferences": {
      "type": "object",
      "description": "Shot preference weights defining the player's playstyle DNA. Each value is a relative weight (0 to 1) indicating how often the player gravitates toward that shot type when they have a free choice. Weights do NOT need to sum to 1 — they are normalized at runtime. These are BASE values — during a match, the engine adjusts them based on what's working/failing (rate of adjustment driven by adaptability attribute). A chopper might have chop: 0.50, push: 0.20. An attacker might have topspinLoop: 0.45, smash: 0.20.",
      "required": ["topspinLoop", "push", "block", "smash", "chop", "flick"],
      "additionalProperties": false,
      "properties": {
        "topspinLoop": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Preference weight for topspin loop attacks."
        },
        "push": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Preference weight for push (controlled backspin return)."
        },
        "block": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Preference weight for blocking (absorbing opponent's power)."
        },
        "smash": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Preference weight for smash (flat, high-speed kill shot)."
        },
        "chop": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Preference weight for chop (heavy backspin, usually from mid-distance)."
        },
        "flick": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Preference weight for flick (wrist snap over short balls)."
        }
      }
    },
    "shots": {
      "type": "object",
      "description": "Shot repertoire. Each shot type has skill ratings that determine quality when executed. Not every player needs high ratings in every shot — gaps in the repertoire are realistic and create exploitable weaknesses.",
      "required": ["topspinLoop", "push", "block", "smash", "chop", "flick"],
      "additionalProperties": false,
      "properties": {
        "topspinLoop": { "$ref": "#/$defs/shotRatings", "description": "Topspin loop — the primary attacking shot. Heavy topspin, medium-to-high speed, arcing trajectory that dips onto the table." },
        "push": { "$ref": "#/$defs/shotRatings", "description": "Push — controlled backspin return, usually short and low. Used to keep the ball tight and prevent attacks." },
        "block": { "$ref": "#/$defs/shotRatings", "description": "Block — compact stroke absorbing the opponent's power. Redirects the ball with minimal backswing. Essential for close-to-table defense." },
        "smash": { "$ref": "#/$defs/shotRatings", "description": "Smash — flat, maximum-speed kill shot against high balls. Minimal spin, maximum power. High risk/reward." },
        "chop": { "$ref": "#/$defs/shotRatings", "description": "Chop — heavy backspin stroke, usually from mid-to-far distance. The signature shot of defensive players. Varied spin range makes choppers dangerous." },
        "flick": { "$ref": "#/$defs/shotRatings", "description": "Flick — wrist-snap attack over short balls that can't be looped. Requires good timing and touch. Key for attacking short serves." }
      }
    },
    "serveTendencies": {
      "type": "object",
      "description": "Serve tendency profile. Instead of named serve types, serves are defined by continuous physical tendencies. The engine samples from these tendencies to generate each serve's intended properties, then applies error based on the service attribute. These are BASE values — the engine adjusts them mid-match based on adaptability. In a future human-player mode, the human can override these directly.",
      "required": ["length", "speed", "spinAmount", "spinVariation", "backspinBias", "sidespinBias", "risk"],
      "additionalProperties": false,
      "properties": {
        "length": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "Placement depth tendency. 0 = always serves short (near the net, low bounce, hard to attack). 100 = always serves long (deep to the end of the table, rushes opponent). 50 = balanced mix."
        },
        "speed": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "Serve speed tendency. 0 = slow serves (maximizes spin and control). 100 = fast serves (rushes opponent but less spin)."
        },
        "spinAmount": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "Spin magnitude tendency. 0 = minimal spin (flat serves). 100 = heavy spin on every serve."
        },
        "spinVariation": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "How much the spin direction and magnitude changes serve-to-serve. 0 = same spin every time (predictable, easy to read after a few serves). 100 = wildly varied (hard to read, but requires high service skill to control). Interacts with deception — high variation + high deception is devastating."
        },
        "backspinBias": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "Tendency toward backspin vs topspin. 0 = pure topspin serves. 50 = equal mix. 100 = pure backspin serves. Most defensive players lean high; attackers lean lower."
        },
        "sidespinBias": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "How much sidespin is added to serves. 0 = no sidespin (pure top/backspin). 100 = heavy sidespin on every serve. Sidespin makes serves curve and is harder to read when combined with top/backspin variation."
        },
        "risk": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "Serve aggression. 0 = safe serves (comfortable margins from net and edges, low fault rate). 100 = aggressive serves (tight to the net, close to edges, more aces but more faults). Interacts with service attribute — high risk + low service = many faults."
        }
      }
    },
    "badges": {
      "type": "array",
      "items": {
        "type": "string",
        "minLength": 1
      },
      "uniqueItems": true,
      "description": "Optional array of badge identifiers that modify simulation calculations. Badges can be positive (buffs) or negative (flaws). The badge system is designed but not active in Phase 1 — this field is accepted but ignored until badges are implemented.",
      "default": []
    }
  },
  "$defs": {
    "rubber": {
      "type": "object",
      "description": "Paddle rubber configuration. Rubber type fundamentally changes what shots are viable and how the ball behaves off the bat.",
      "required": ["type", "spin", "speed", "control"],
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": ["inverted", "shortPips", "longPips", "antispin"],
          "description": "Rubber surface type. inverted = smooth, grippy, maximum spin (most common). shortPips = small pimples out, less spin-sensitive, good for flat hitting. longPips = long pimples out, reverses incoming spin, disrupts opponents. antispin = slick surface, minimal friction, deadens spin."
        },
        "spin": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "Spin generation capability. How much spin the rubber can impart on the ball."
        },
        "speed": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "Speed capability. How much pace the rubber adds to shots."
        },
        "control": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "Control rating. How predictable and precise shots are off this rubber. Typically inversely correlated with speed."
        }
      }
    },
    "shotRatings": {
      "type": "object",
      "description": "Skill ratings for a specific shot type. Scale: 0 (no ability) to 100 (theoretical human peak).",
      "required": ["power", "spinRange", "accuracy", "consistency"],
      "additionalProperties": false,
      "properties": {
        "power": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "Maximum power the player can generate on this shot. Subject to degradation from poor positioning, time pressure, and fatigue."
        },
        "spinRange": {
          "type": "object",
          "description": "The range of spin magnitude the player can apply on this shot. Min/max define the bounds — actual spin per shot is sampled from this range. Wide range = varied (deceptive with high deception stat). Narrow range = predictable.",
          "required": ["min", "max"],
          "additionalProperties": false,
          "properties": {
            "min": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100,
              "description": "Minimum spin magnitude the player puts on this shot type."
            },
            "max": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100,
              "description": "Maximum spin magnitude the player puts on this shot type. Must be >= min."
            }
          }
        },
        "accuracy": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "Placement accuracy. Determines the width of the Gaussian error distribution around the intended target. High accuracy = tight grouping. Low accuracy = shots land far from intended target."
        },
        "consistency": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "Shot-to-shot reliability. How often the player executes this shot at their skill level vs making an error. Low consistency = occasional shanks and mishits even in ideal conditions."
        }
      }
    }
  }
}
